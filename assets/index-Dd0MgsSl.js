(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}})();document.createElement("canvas");async function d(r,i){return await(await fetch(`${r}/status/${i}.json`)).json()}async function p(r,i){return{status:(await fetch(`${r}/cancel/${i}`,{method:"DELETE"})).status}}async function u(r,i){return await(await fetch(`${r}/report.${i.format}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json()}async function S(r,i,n=1e3,o=3e4){let e=0-n;return new Promise((t,s)=>{const f=setInterval(async()=>{let c;try{if(c=await d(r,i.ref),c.error)throw new Error(c.error)}catch(m){s(m)}c.done&&(clearInterval(f),t(`${r}/report/${i.ref}`)),e+=n,e>=o&&(clearInterval(f),s(new Error("Print duration exceeded")))},n)})}let l="https://sys-map.dev.bgdi.ch/api/print3/print/mapviewer",a=null;document.querySelector("#cancel").addEventListener("click",async()=>{const r=document.querySelector("#result"),i=document.querySelector("#mfpURL");a?(i.value&&(l=i.value),(await p(l,a.ref)).status===200?r.innerHTML="Print is canceled":r.innerHTML="Failed to cancel print"):r.innerHTML="No print in progress"});document.querySelector("#print").addEventListener("click",async()=>{console.log("print");const r=document.querySelector("#mfpURL"),i=document.querySelector("#spec"),n=document.querySelector("#report"),o=document.querySelector("#result");n.innerHTML="Loading...",o.innerHTML="Loading...",r.value?l=r.value:r.innerHTML=l;let e={format:"pdf",layout:"1. A4 landscape",attributes:{map:{center:[26e5,12e5],dpi:96,layers:[{baseURL:"https://sys-wmts.dev.bgdi.ch/1.0.0/ch.vbs.waldschadenkarte/default/current/2056/{TileMatrix}/{TileCol}/{TileRow}.png",imageFormat:"image/png",requestEncoding:"REST",layer:"ch.vbs.waldschadenkarte",type:"WMTS",style:"ch.vbs.waldschadenkarte",matrixSet:"2056_26",matrices:[{identifier:0,scaleDenominator:14285714285714287e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:1,scaleDenominator:13392857142857144e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:2,scaleDenominator:12500000000000002e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:3,scaleDenominator:11607142857142858e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:4,scaleDenominator:10714285714285715e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:5,scaleDenominator:9821428571428573e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:6,scaleDenominator:892857142857143e-8,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:7,scaleDenominator:8035714285714286e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:8,scaleDenominator:7142857142857144e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1,1]},{identifier:9,scaleDenominator:6250000000000001e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[2,1]},{identifier:10,scaleDenominator:5357142857142857e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[2,1]},{identifier:11,scaleDenominator:4464285714285715e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[2,1]},{identifier:12,scaleDenominator:3571428571428572e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[2,2]},{identifier:13,scaleDenominator:2.6785714285714286e6,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[3,2]},{identifier:14,scaleDenominator:2321428571428572e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[3,2]},{identifier:15,scaleDenominator:1785714285714286e-9,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[4,3]},{identifier:16,scaleDenominator:892857.142857143,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[8,5]},{identifier:17,scaleDenominator:357142.85714285716,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[19,13]},{identifier:18,scaleDenominator:178571.42857142858,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[38,25]},{identifier:19,scaleDenominator:71428.57142857143,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[94,63]},{identifier:20,scaleDenominator:35714.28571428572,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[188,125]},{identifier:21,scaleDenominator:17857.14285714286,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[375,250]},{identifier:22,scaleDenominator:8928.57142857143,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[750,500]},{identifier:23,scaleDenominator:7142.857142857143,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[938,625]},{identifier:24,scaleDenominator:5357.142857142858,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1250,834]},{identifier:25,scaleDenominator:3571.4285714285716,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[1875,1250]},{identifier:26,scaleDenominator:1785.7142857142858,topLeftCorner:[242e4,135e4],tileSize:[256,256],matrixSize:[3750,2500]}]}],projection:"EPSG:2056",rotation:0,scale:5e5},legend:{name:"",classes:[{name:"Hausnummer und Sachplan",icons:["https://sys-api3.dev.bgdi.ch/static/images/legends/ch.swisstopo.amtliches-gebaeudeadressverzeichnis_de.png","https://sys-api3.dev.bgdi.ch/static/images/legends/ch.bfe.sachplan-uebertragungsleitungen_kraft_de.png"]}]},name:"Test less simple report",qrimage:"https://sys-map.dev.bgdi.ch/api/qrcode/generate?url=https://s.geo.admin.ch/jgomwqlylah8",copyright:"Â© swisstopo, swisstopo & FGS",url:"https://map.geo.admin.ch"}};console.log(i.value),i.value&&(e=JSON.parse(i.value)),console.log("spec",e),a=await u(l,e),console.log("report",a),n.innerHTML=JSON.stringify(a,null,"  "),await S(l,a,1e3).then(t=>(o.innerHTML=t,document.location=t,t),t=>(console.log("result","error",t),o.innerHTML=t,t)).finally(()=>{a=null})});
